<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Intersophia – FAQ</title>
  <meta name="description" content="Prosty landing page FAQ w stylu OneNote, responsywny i gotowy na GitHub Pages." />
  <style>
    :root {
      --brand-orange: #D66C2C; /* CTA / brand */
      --brand-blue: #4A93C3;   /* Linki / akcenty */
      --white: #FFFFFF;
      --black: #000000;
      --light-gray: #EEEEEE;

      --bg: var(--white);
      --panel: var(--light-gray);
      --text: var(--black);
      --muted: #555;
      --border: #ccc;
      --shadow: 0 10px 30px rgba(0,0,0,.1);
      --radius: 16px;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: var(--black);
        --panel: #111318;
        --text: var(--white);
        --muted: #9aa4b2;
        --border: #222631;
        --shadow: 0 10px 30px rgba(0,0,0,.35);
      }
    }

    html, body { height: 100%; margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); }
    a { color: inherit; text-decoration: none; }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }

    html { color-scheme: light dark; scroll-behavior: smooth; }

    /* ===== HEADER (banner logo) ===== */
    header { position: sticky; top: 0; z-index: 50; background: var(--bg); }
    .bar { display:flex; align-items:center; justify-content:center; padding: 0; border-bottom: 1px solid var(--border); }
    .logo-banner { width: 100%; height: 120px; display:flex; align-items:center; justify-content:flex-start; padding-left: 24px; box-shadow: var(--shadow); }
    .logo-banner img { max-height: 80%; height:auto; width:auto; display:block; }

    /* ===== LAYOUT ===== */
    .layout { display: grid; grid-template-columns: 320px 1fr; grid-auto-flow: dense; gap: 24px; }
    .main { grid-column: 2; grid-row: 1; background: var(--panel); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
    .main-content { padding: 24px; }
    .question { scroll-margin-top: 140px; }
    .question h2 { margin: 0 0 8px 0; font-size: 22px; color: var(--brand-blue); }
    .question .meta { color: var(--muted); font-size: 14px; margin-bottom: 14px; }
    .question + .question { border-top:1px solid var(--border); padding-top: 24px; margin-top: 24px; }

    /* Sidebar (left) */
    .sidebar { grid-column: 1; grid-row: 1; position: sticky; top: 140px; align-self: start; max-height: calc(100dvh - 180px); overflow: auto; background: var(--panel); border:1px solid var(--border); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); }
    .side-section + .side-section { border-top:1px dashed var(--border); margin-top: 10px; padding-top: 10px; }
    .side-title { font-size: 13px; text-transform: uppercase; letter-spacing: .12em; color: var(--brand-orange); margin: 4px 0 8px; }
    .side-subtitle { font-size: 12px; font-weight: 600; letter-spacing: .06em; color: var(--muted); margin: 6px 0; }
    .side-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:6px; }
    .side-list a { display:block; padding:8px 10px; border-radius: 10px; border:1px solid transparent; }
    .side-list a:hover { background: rgba(74, 147, 195, .08); border-color: var(--border); }
    .side-list a.active { background: rgba(74,147,195,.16); }

    /* ===== MOBILE (accordion-first) ===== */
    .mobile { display:none; }
    .accordion { background: var(--panel); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; }
    .acc-item + .acc-item { border-top:1px solid var(--border); }
    .acc-btn { width:100%; text-align:left; padding:16px; background:none; border:none; color:var(--text); font-size:16px; display:flex; justify-content:space-between; align-items:center; }
    .acc-btn .chev { transition: transform .2s ease; }
    .acc-panel { max-height:0; overflow:hidden; transition: max-height .25s ease; padding: 0 16px; }
    .acc-panel.open { padding-bottom: 16px; }

    /* Ustawienie kotwic dla akordeonu, by po otwarciu panel ustawił się pod nagłówkiem */
    .acc-item { scroll-margin-top: 140px; }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 960px) {
      .layout { display:none; }
      .mobile { display:block; }
      .logo-banner { height: 100px; justify-content:center; padding-left: 0; }
      /* Większy offset dla nagłówka na mobile, by pytanie było widoczne od początku */
      .accordion .acc-item { scroll-margin-top: 112px; }
    }
  
    /* === Dark mode: biała strona + biały główny kontener === */
    @media (prefers-color-scheme: dark) {
      /* Główny kontener (treść) – białe tło i ciemny tekst */
      .main {
        /* Nadpisujemy lokalnie tokeny tylko w obrębie .main */
        --panel: #ffffff;
        --text: #000000;
        --muted: #555555;
        --border: #e5e7eb;

        background: var(--panel);
        color: var(--text);
        border-color: var(--border);
        box-shadow: 0 10px 30px rgba(0,0,0,.08);
      }

      .main .question h2 { color: var(--brand-blue); }
      .main .meta { color: var(--muted); }
    }
  </style>
</head>
<body>
  <!-- ===== HEADER with full-width banner logo (SVG) ===== -->
  <header>
    <div class="bar">
      <div class="logo-banner">
        <img src="assets/logo.svg" alt="Intersophia — logotyp" class="logo-img" loading="eager" decoding="async" />
      </div>
    </div>
  </header>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="container">
    <!-- Desktop/tablet layout: content + left sidebar -->
    <div class="layout" id="desktopLayout" aria-label="Widok szeroki">
      <section class="main" id="content">
        <div class="main-content" id="contentInner"></div>
      </section>
      <aside class="sidebar" id="sidebar" aria-label="Nawigacja po pytaniach"></aside>
    </div>

    <!-- Mobile layout: accordion list first -->
    <section class="mobile" aria-label="Widok mobilny">
      <div class="accordion" id="mobileAccordion"></div>
    </section>
  </main>

  <footer class="container" style="opacity:.7; font-size:13px; padding:32px 24px;">
    © <span id="year"></span> Intersophia. Hostowane na GitHub Pages. – <a href="#" id="toTop">Powrót na górę</a>
  </footer>

  <script>
    // ===== DATA MODEL (external) =====
    let FAQ = [];

    async function loadFAQ() {
      const res = await fetch('faq-data.json', { cache: 'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      if (!Array.isArray(data)) throw new Error('FAQ musi być tablicą sekcji');
      return data;
    }

    // ===== HELPERS =====
    const $ = (id) => document.getElementById(id);

    // ===== RENDER DESKTOP =====
    function renderDesktop(){
      const content = $('contentInner');
      const sidebar = $('sidebar');
      if(!content || !sidebar) return;

      content.innerHTML = '';
      sidebar.innerHTML = '';

      FAQ.forEach(section => {
        // Sidebar section title
        const sec = document.createElement('div');
        sec.className = 'side-section';
        sec.innerHTML = `<div class="side-title">${section.section}</div>`;

        const list = document.createElement('ul');
        list.className = 'side-list';

        (section.items || []).forEach(item => {
          // Content
          const div = document.createElement('article');
          div.className = 'question';
          div.id = item.id;
          div.innerHTML = `
            <h2>${item.q}</h2>
            <div class="answer">${item.a}</div>
          `;
          content.appendChild(div);

          // Sidebar link
          const li = document.createElement('li');
          li.innerHTML = `<a href="#${item.id}">${item.q}</a>`;
          list.appendChild(li);
        });

        sec.appendChild(list);
        sidebar.appendChild(sec);
      });

      // Active link highlight
      const links = sidebar.querySelectorAll('a');
      const map = Array.from(links).map(a => ({ link:a, target: $(a.getAttribute('href').slice(1)) }));
      const obs = new IntersectionObserver((entries)=>{
        entries.forEach(entry => {
          const found = map.find(m => m.target === entry.target);
          if(found && entry.isIntersecting) {
            map.forEach(m => m.link.classList.remove('active'));
            found.link.classList.add('active');
          }
        });
      }, { rootMargin: '-40% 0px -55% 0px', threshold: 0.01 });
      map.forEach(m => m && m.target && obs.observe(m.target));
    }

    // ===== RENDER MOBILE =====
    function renderMobile(){
      const acc = $('mobileAccordion');
      acc.innerHTML = '';
      FAQ.forEach(section => {
        const heading = document.createElement('div');
        heading.className = 'side-title';
        heading.style.margin = '10px 12px';
        heading.textContent = section.section;
        acc.appendChild(heading);

        (section.items || []).forEach(item => {
          const wrap = document.createElement('div');
          wrap.className = 'acc-item';
          wrap.innerHTML = `
            <button class="acc-btn" aria-expanded="false" aria-controls="p-${item.id}">
              <span>${item.q}</span>
              <span class="chev">▾</span>
            </button>
            <div class="acc-panel" id="p-${item.id}" role="region" aria-labelledby="q-${item.id}">
              <div class="acc-body" style="padding-top:10px;">${item.a}</div>
            </div>
          `;
          acc.appendChild(wrap);
        });
      });

      acc.addEventListener('click', (e)=>{
        const btn = e.target.closest('.acc-btn');
        if(!btn) return;
        const item = btn.parentElement;
        const panel = item.querySelector('.acc-panel');
        const chev = btn.querySelector('.chev');
        const open = panel.style.maxHeight && panel.style.maxHeight !== '0px';
        if(open){
          panel.style.maxHeight = '0px';
          panel.classList.remove('open');
          btn.setAttribute('aria-expanded','false');
          chev.style.transform = 'rotate(0deg)';
        } else {
          acc.querySelectorAll('.acc-panel').forEach(p => { p.style.maxHeight='0px'; p.classList.remove('open'); });
          acc.querySelectorAll('.acc-btn').forEach(b => b.setAttribute('aria-expanded','false'));
          acc.querySelectorAll('.chev').forEach(c => c.style.transform = 'rotate(0deg)');
          panel.style.maxHeight = panel.scrollHeight + 'px';
          panel.classList.add('open');
          btn.setAttribute('aria-expanded','true');
          chev.style.transform = 'rotate(180deg)';
          const scrollNow = () => item.scrollIntoView({ behavior: 'smooth', block: 'start' });
          const onEnd = (ev) => { if (ev.target !== panel) return; scrollNow(); };
          panel.addEventListener('transitionend', onEnd, { once: true });
          requestAnimationFrame(() => requestAnimationFrame(scrollNow));
        }
      });
    }

    // ===== SCROLL TO TOP =====
    document.addEventListener('click', (e)=>{
      const a = e.target.closest('#toTop');
      if(!a) return; e.preventDefault(); window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Sidebar click: align to top
    (function setupSidebarTopAlign() {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar) return;
      sidebar.addEventListener('click', (e) => {
        const link = e.target.closest('a[href^="#"]');
        if (!link) return;
        e.preventDefault();
        const id = link.getAttribute('href').slice(1);
        const target = document.getElementById(id);
        if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    })();

    // ===== TESTS =====
    function runTests() {
      try {
        const totalItems = FAQ.reduce((n, s) => n + (s.items ? s.items.length : 0), 0);
        console.info('[TEST] FAQ items count:', totalItems);
        console.assert(totalItems > 0, 'FAQ should have at least one item');

        const articles = document.querySelectorAll('.question');
        console.info('[TEST] Rendered desktop articles:', articles.length);
        console.assert(articles.length === totalItems, 'All FAQ items should render as articles in desktop view');

        const accItems = document.querySelectorAll('#mobileAccordion .acc-item');
        console.info('[TEST] Rendered mobile accordion items:', accItems.length);
        console.assert(accItems.length === totalItems, 'All FAQ items should render in the mobile accordion');

        const navLinks = document.querySelectorAll('#sidebar a').length;
        console.assert(navLinks === totalItems, 'Sidebar links should equal total FAQ items');

        const ids = FAQ.flatMap(s => (s.items||[]).map(i => i.id));
        const dupes = ids.filter((id, idx) => ids.indexOf(id) !== idx);
        console.assert(dupes.length === 0, 'FAQ item IDs must be unique: ' + dupes.join(', '));

        console.log('%cSelf-tests passed', 'color: green;');
      } catch (e) {
        console.error('Self-tests failed:', e);
      }
    }

    // Keep accordion heights in sync on resize
    window.addEventListener('resize', ()=>{
      document.querySelectorAll('.acc-panel.open').forEach(p => { p.style.maxHeight = p.scrollHeight + 'px'; });
    });

    // ===== INIT =====
    (async function init(){
      try {
        FAQ = await loadFAQ();
        renderDesktop();
        renderMobile();
        runTests();
      } catch (e) {
        console.error('Nie udało się wczytać FAQ z faq-data.json:', e);
        const content = document.getElementById('contentInner');
        if (content) content.innerHTML = '<p style="opacity:.7">Brak danych FAQ – sprawdź plik <code>faq-data.json</code>.</p>';
      } finally {
        const y = document.getElementById('year');
        if (y) y.textContent = new Date().getFullYear();
      }
    })();
  </script>
</body>
</html>
